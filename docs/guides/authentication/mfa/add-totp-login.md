# MFA with TOTP

The Time-based One Time Password(TOTP) is a temporary passcode, generated by an algorithm, which can be used only once. The algorithm that generates each password uses the current time of the day as one of its factors, ensuring that each password is unique.
TOTP is considered more secure because the passcode is valid only for a short window of time. The TOTP generated by Asgardeo is valid for **30** seconds.

TOTP authenticator uses the [TOTP specification](https://datatracker.ietf.org/doc/html/rfc6238) to calculate the access tokens based on the time and the shared secret key between the user and the identity provider.

To use TOTP as a multi-factor authentication(MFA) option, users need to have an authenticator app that can scan the QR code and generate a one-time password. Some authenticator apps are:
- [Google Authenticator](https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2)
- [Authy](https://play.google.com/store/apps/details?id=com.authy.authy)

## Prerequisites
-   To get started, you need to have an application registered in Asgardeo. If you don't already have, register one of the following application types.
    -   <a :href="$withBase('/guides/applications/register-single-page-app/')">Single-page app</a>
    -   <a :href="$withBase('/guides/applications/register-oidc-web-app/')">Web app with OIDC</a>
    -   <a :href="$withBase('/guides/applications/register-saml-web-app/')">Web app with SAML</a>
-   Download and install one of the authenticator apps mentioned above.

::: info Info
 - You can use TOTP for multi-factor authentication only if a previous authentication step is configured with **username and password** or another factor.   
 - TOTP cannot be used as the first step of your login flow.
 - Federated users(users who are authenticated with external IdPs) can log in with TOTP MFA option.
:::


## Enable TOTP for an app
To enable TOTP as a factor for multi-factor authentication, you need to add **TOTP** in the authentication flow of an application. The steps given below will guide you on how to enable TOTP for an application:
1. On the Asgardeo console, there are two ways to start enabling TOTP for an application. Follow either of the options given below.
 - Option1: Navigate to **Develop > Applications**.
 - Option2: Navigate to **Connections > TOTP** and click **Connect**.
2. Select the application for which the TOTP needs to be added.
3. Go to the **Sign-in Method** tab.
4. Click **Add TOTP as a second factor**. This will add TOTP as a second factor authenticator.
    <img :src="$withBase('/assets/img/guides/mfa/totp/add-totp-authenticator.png')" alt="Configuring TOTP authenticator in Asgardeo">
5. Click **Update**.

## Enroll TOTP during first login 
Users can enroll for TOTP notification from the first login to the business application using some authenticator apps. Follow the steps as a user who wants to access the authenticator app from your mobile and enroll to TOTP.
1. Download authenticator.
2. Log in to the application. You are prompted with a QR code.
3. Scan the code and click **Continue**. 
    ::: info
        This step is prompted only when you attempt to log in for the first time.
    :::
    <img :src="$withBase('/assets/img/guides/mfa/totp/scan-qr-code-totp.png')" alt="QR code for TOTP authenticator in Asgardeo" width="300">
4. Check your authenticator for which you used to scan the code.
    <img :src="$withBase('/assets/img/guides/mfa/totp/google-authenticator.png')" alt="OTP token from the authenticator" width="300">
5. Enter the OTP by checking the authenticator app.
    <img :src="$withBase('/assets/img/guides/mfa/totp/enter-otp-token.png')" alt="User enters OTP token in Asgardeo" width="300">
6. Click **Continue**.

If the QR code is deleted from the authentictor app, there is no way to recover it from the application's end. In a scenario like this the user should <a :href="$withBase('/guides/user-self-service/enable-totp/')">enable TOTP</a> through the <b>Multi Factor Authentication</b> option in the My Account portal. 