# SAML settings

You can find the SAML protocol related settings under **protocol** section of the selected SAML application. 
  <img :src="$withBase('/assets/img/guides/applications/saml-app/saml-settings.png')" alt="SAML settings">
 
## Basic settings

### Assertion consumer service URLs
The Assertion Consumer Service (ACS) URL determines where to send the SAML response. 

However, if the SAML2 request is signed and SAML2 request contains the ACS URL, the Asgardeo will honor the ACS URL of the SAML2 request. It should have this format: https://(host-name):(port)/acs .

An application can have multiple ACS URLs.

<br>

### Default assertion consumer service URL
Since there can be multiple assertion consumer URLs, you must define a Default Assertion Consumer URL in case Asgardeo is unable to retrieve it from the authentication request.

::: tip In a sign-on request by a SAML app, following needs to be considered
- If **no ACS URL is given in the <code>< AuthnRequest ></code>**, the Asgardeo sends the response to the **default ACS URL** of the service provider (whether the request is signed or not).
- If the **ACS URL in <code>< AuthnRequest ></code> matches** with one of the registered URLs, the Asgardeo sends the response to the **matched one**.
- If the **ACS URL in <code>< AuthnRequest ></code> does not match any** of the registered ACS URLs and if the **request is signed**, the Asgardeo sends the response to the **ACS URL in the request** only if the signature is valid. Alternatively, the <code>< AuthnRequest ></code> is rejected.
:::

### IdP entity ID alias
This value can override the default Identity Provider (IdP) entity ID (accounts.asgardeo.io). The IdP entity ID is used as the `saml2:Issuer` of the SAML response that is generated by Asgardeo.

```xml
<saml2:Issuer Format="urn:oasis:names:tc:SAML:2.0:nameid-format:entity"
                  xmlns:saml2="urn:oasis:names:tc:SAML:2.0:assertion"
                  >accounts.asgardeo.io</saml2:Issuer>
```
<br>

## Advanced settings

### Request Validation

#### Enable request signature validation
This specifies whether Asgardeo must validate the signature of the SAML authentication request and the SAML logout request that are sent by the application.
<br>

### Response Signing

#### Sign SAML Response
This specifies whether the SAML responses generated by Asgardeo should be signed.

#### Digest algorithm
This is used as the digest algorithm in authentication response and logout response. This is specified as the `DigestMethod` algorithm in the `Signature` element. 

#### Signing algorithm

This is used as the signing algorithm to sign the authentication response and logout response. This specifies the `SignatureMethod` algorithm to be used in the `Signature` element in the SAML response.
<br>

### Single Sign-On Profile

#### Bindings
This specifies the mechanisms to transport SAML messages in communication protocols. Bindings define how SAML assertions and request-response protocol messages can be exchanged between identity provider and SAML application.

Asgardeo supports below bindings:
- HTTP Post
- HTTP Redirect
- Artifact

Asgardeo by default supports HTTP Post and HTTP Redirect bindings. To enable support for Artifact binding, select **Artifact**.

#### Enable signature validation for artifact binding
This specifies whether the artifact resolve request signature should be validated against the application certificate. If you enable this option, make sure to provide the application certificate below.

#### Enable Idp initiated SSO
This specifies whether to initiate Single Sign-On (SSO) from the IdP instead of the application. If this is selected, a service provider is not required to send the SAML2 request.
<br>

### Assertion

#### Name ID format
This specifies the name identifier format that is used to exchange information regarding the user in the SAML assertion.

For SSO interactions, you can configure the following types of NameID formats.

- urn:oasis:names:tc:SAML:2.0:nameid-format:persistent
- urn:oasis:names:tc:SAML:2.0:nameid-format:transient
- urn:oasis:names:tc:SAML:1.1:nameid-format:emailAddress
- urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified
- urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName
- urn:oasis:names:tc:SAML:1.1:nameid-format:WindowsDomainQualifiedName
- urn:oasis:names:tc:SAML:2.0:nameid-format:kerberos
- urn:oasis:names:tc:SAML:2.0:nameid-format:entity

This specifies the name identifier format that the application wants to receive in the subject of an assertion from Asgardeo. 

Asgardeo uses `urn:oasis:names:tc:SAML:1.1:nameid-format:emailAddress` as the default name identifier.

```xml
<saml2:Assertion ID="_1fc418b1886158a8c239f9ee5205718b"
                     IssueInstant="2021-07-07T08:28:30.228Z"
                     Version="2.0"
                     xmlns:saml2="urn:oasis:names:tc:SAML:2.0:assertion"
                     >
   -
   -
    <saml2:Subject>
        <saml2:NameID Format="urn:oasis:names:tc:SAML:1.1:nameid-format:emailAddress">Alica@bifrost.com</saml2:NameID>
        <saml2:SubjectConfirmation Method="urn:oasis:names:tc:SAML:2.0:cm:bearer">
            <saml2:SubjectConfirmationData InResponseTo="mjagocahejhadgbaldpgpoipaghellkjkdnpilcp"
                                                   NotOnOrAfter="2021-07-07T08:33:30.228Z"
                                                   Recipient="http://localhost:8080/sample-app/home.jsp"
                                                   />
        </saml2:SubjectConfirmation>
    </saml2:Subject>
    -
    -
</saml2:Assertion>
```

#### Audiences
This specifies the audiences, to whom this SAML assertion is intended. 

The issuer of the application will be added as the default audience
```xml
<saml2:Assertion ID="_1fc418b1886158a8c239f9ee5205718b"
                     IssueInstant="2021-07-07T08:28:30.228Z"
                     Version="2.0"
                     xmlns:saml2="urn:oasis:names:tc:SAML:2.0:assertion"
                     >
   -
   -
    <saml2:AudienceRestriction>
         <saml2:Audience>https://sampleapp.com/saml/sp</saml2:Audience>
    </saml2:AudienceRestriction>
   -
   -
</saml2:Assertion>
```
<br>

#### Recipients
Recipient is a URI specifying the entity or location to which Asgardeo can present the assertion. 

For example, this attribute might indicate that the assertion must be delivered to a particular network endpoint in order to prevent an intermediary from redirecting it someplace else.

By default, Asgardeo sends `ACS URL` as the `recipient` value.

```xml
<saml2:Assertion ID="_1fc418b1886158a8c239f9ee5205718b"
                     IssueInstant="2021-07-07T08:28:30.228Z"
                     Version="2.0"
                     xmlns:saml2="urn:oasis:names:tc:SAML:2.0:assertion"
                     >
        -
        -
        <saml2:Subject>
            <saml2:NameID Format="urn:oasis:names:tc:SAML:1.1:nameid-format:emailAddress">Alica@bifrost.com</saml2:NameID>
            <saml2:SubjectConfirmation Method="urn:oasis:names:tc:SAML:2.0:cm:bearer">
                <saml2:SubjectConfirmationData InResponseTo="mjagocahejhadgbaldpgpoipaghellkjkdnpilcp"
                                               NotOnOrAfter="2021-07-07T08:33:30.228Z"
                                               Recipient="http://localhost:8081/sample-app/home.jsp"
                                               />
            </saml2:SubjectConfirmation>
        </saml2:Subject>
        -
        -
</saml2:Assertion>
```

After adding `http://localhost:8081/sample-app-new/home.jsp` as a `recipient`:

```xml
<saml2:Subject>
            <saml2:NameID Format="urn:oasis:names:tc:SAML:1.1:nameid-format:emailAddress">Alica@bifrost.com</saml2:NameID>
            <saml2:SubjectConfirmation Method="urn:oasis:names:tc:SAML:2.0:cm:bearer">
                <saml2:SubjectConfirmationData InResponseTo="jegiegkloeahkcllbnbcohgdeklidegeoiijhado"
                                               NotOnOrAfter="2021-07-07T08:44:45.727Z"
                                               Recipient="http://localhost:8081/sample-app/home.jsp"
                                               />
            </saml2:SubjectConfirmation>
            <saml2:SubjectConfirmation Method="urn:oasis:names:tc:SAML:2.0:cm:bearer">
                <saml2:SubjectConfirmationData InResponseTo="jegiegkloeahkcllbnbcohgdeklidegeoiijhado"
                                               NotOnOrAfter="2021-07-07T08:44:45.727Z"
                                               Recipient="http://localhost:8081/sample-app-new/home.jsp"
                                               />
            </saml2:SubjectConfirmation>
        </saml2:Subject>
```

### Attribute Profile

#### Enable attribute profile

This specifies whether to include the userâ€™s attributes in the SAML assertions as part of the attribute statement. You can configure user attributes by navigating to **User Attributes** section in the application.

<br>

### Single Logout Profile
All the settings under this are related to single-logout. In Single logout, if another application in the same session logs out, Asgardeo will send logout request to the saml application as well.

#### Enable SLO
Specifies this whether you want to enable single-logout to your application. By default, it this is disabled for applications.

#### Logout method
Specifies the logout method that is supported by the application. Asgardeo supports below logout methods:
- Back Channel logout
- Front Channel HTTP Redirect
- Front Channel HTTP Post

Back Channel logout is enabled by default.

#### Single logout response URL
This specifies the endpoint of the application to where the single logout response should be sent. If you do not specify this URL, Asgardeo will use the ACS URL.

#### Single logout request URL
This specifies the endpoint of the application to where the single logout request should be sent. If you do not specify this URL, Asgardeo will use the ACS URL.

#### IdP initiated single logout
Asgardeo will terminate its session if an external identity provides sends logout request to Asgardeo when Asgardeo acts as a SAML app.

**Enable:**
This specifies whether to support IdP initiated logout.

**Return to URLs:**
This specifies the URLs to which the user should be redirected after the logout.

### Certificate
You can upload the certificate of your SAML application here. This certificate is used to validate the signature if authentication request and logout request are signed by application. 

To validate signature for authentication and logout requests, you need to [enable request signature validation](#enable-request-signature-validation)

  <img :src="$withBase('/assets/img/guides/applications/saml-app/upload-certificate-of-app.png')" alt="Upload app certificate">

You need to upload the certificate in PEM format.

::: details If you have certificate in other formats such as `.crt`, `.cer` or `.der`, expand here to convert your certs to PEM format using <a href ="https://www.openssl.org/" target="_blank">OpenSSL</a>
     **Convert CRT to PEM**
     ```
     openssl x509 -in cert.crt -out cert.pem
     ``` 
    **Convert CER to PEM:**
     ```
     openssl x509 -in cert.cer -out cert.pem
     ```  
    **Convert DER to PEM:**
      ```
      openssl x509 -in cert.der -out cert.pem
     ```
:::    

<br>
